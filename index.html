<!DOCTYPE HTML> 
<html lang="en"> 
<head>
  <title>PeerJS chat demo</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
  <meta http-equiv="Content-Language" content="en-us"> 

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  <link href="./fancy.css" rel="stylesheet" type="text/css">

  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>

  <script type="text/javascript" src="./peer.js"></script>

  <script>
    var userName = 'jitesh';
    var connection, peer;
    // Connect to PeerJS, have server assign an ID instead of providing one
    // Showing off some of the configs available with PeerJS :).
    peer = new Peer(userName, {
      // Set API key for cloud server (you don't need this if you're running your
      // own.
      key: 'x7fwx2kavpy6tj4i',
      // Set highest debug level (log everything!).
      debug: 3,
      // Set a logging function:
      logFunction: console.log
    });
    // var connectedPeers = {};
    // Show this peer's ID.
    peer.on('open', function (id) {
      $('#pid').text(id);
    });
    // Await connections from others
    peer.on('connection', connect);
    // Log in case of any error
    peer.on('error', function (err) {
      console.log(err);
    });
    // Handle a connection object.
    function connect(c) {
      // Keep a global reference
      connection = c;
      // Add data listener
      c.on('data', function (data) {
        $('.messages').append('<div><span class="peer">' + c.peer + '</span>: ' + data + '</div>');
      });
      // Show alert when closed
      c.on('close', function () {
        alert(c.peer + ' has left the chat.');
      });
    }
    $(document).ready(function () {
      // Connect to a peer
      $('.connect').click(function () {
        var requestedPeer = $(this).text();
        // Close the old connection
        connection.close();
        // Create a new connection
        connection = peer.connect(requestedPeer, {
          label: 'chat',
          serialization: 'none',
          metadata: {message: 'hi i want to chat with you!'}
        });
        connection.on('open', function () {
          connect(connection);
        });
        connection.on('error', function (err) {
          alert(err);
        });
      });
      // Send a chat message to all active connections.
      $('#send').submit(function (e) {
        e.preventDefault();
        // Get the message
        var msg = $('#text').val();
        // Send the message
        connection.send(msg);
        // Show in the UI with title 'You'
        $('.message').append('<div><span class="you">You: </span>' + msg + '</div>');
        // Reset and focus on the input box
        $('#text').val('');
        $('#text').focus();
      });
    });
    // Make sure things clean up properly.
    window.onunload = window.onbeforeunload = function (e) {
      if (!!peer && !peer.destroyed) {
        peer.destroy();
      }
    };
  </script>
</head> 
 
<body> 
  <div class="container">
    <div class="row color-slack">
      <div class="col-md-offset-4">
        <h1>
          CHIT - CHAT APP
        </h1>
      </div>
    </div>
    <div class="row color-slack">
      <div class="col-md-offset-4">
        <h3>Your PeerJS ID is <span id="pid"></span></h3>    
      </div>
    </div>
    <div class="row">
      <div class="col-md-12 button-title" >
        <h2>Connect to a peer</h2>
      </div>
    </div>
    <div class="row">
      <div class="col-md-3 button-section"> 
        <div class="list-group">
          <button type="button" class="list-group-item connect" >
            <span class="glyphicon glyphicon-info-sign"></span>&nbsp;
            <span class="glyphicon glyphicon-envelope"></span>&nbsp;&nbsp;
            Abhishek
          </button>
          <button type="button" class="list-group-item connect">
            <span class="glyphicon glyphicon-info-sign"></span>&nbsp;
            <span class="glyphicon glyphicon-envelope"></span>&nbsp;&nbsp;
            Rajat
          </button>
          <button type="button" class="list-group-item connect">
            <span class="glyphicon glyphicon-info-sign"></span>&nbsp;
            <span class="glyphicon glyphicon-envelope"></span>&nbsp;&nbsp;
            Ankur
          </button>
          <button type="button" class="list-group-item connect">
            <span class="glyphicon glyphicon-info-sign"></span>&nbsp;
            <span class="glyphicon glyphicon-envelope"></span>&nbsp;&nbsp;
            Varun
          </button>
          <button type="button" class="list-group-item connect">
            <span class="glyphicon glyphicon-info-sign"></span>&nbsp;
            <span class="glyphicon glyphicon-envelope"></span>&nbsp;&nbsp;
            Jitesh
          </button>
          <button type="button" class="list-group-item connect">
            <span class="glyphicon glyphicon-info-sign"></span>&nbsp;
            <span class="glyphicon glyphicon-envelope"></span>&nbsp;&nbsp;
            Dummy
          </button>
        </div>
      </div>
      <div class="col-md-9">
        <div class="chat">
          &nbsp;
          <div id="messages"></div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <div class="input-group">
              <input type="text" class="form-control" type="text" class="form-control" id="text" placeholder="Type your message here">
              <span class="input-group-btn">
                <button class="btn btn-default" type="button" id="send">SEND</button>
              </span>
            </div>
          </div>
        </div> 
      </div>
    </div>
  </div>  
</body> 
</html> 


<!-- 

  <div id="actions">
    Your PeerJS ID is <span id="pid"></span><br>
    Connect to a peer: <input type="text" id="rid" placeholder="Someone else's id"><input class="button" type="button" value="Connect" id="connect"><br><br>

    <form id="send">
      <input type="text" id="text" placeholder="Enter message"><input class="button" type="submit" value="Send to selected peers">
    </form>
    <button id="close">Close selected connections</button>
  </div>

  <div id="wrap"><div id="connections"><span class="filler">You have not yet
        made any connections.</span></div>
    <div class="clear"></div></div>

  <div id="box" style="background: #fff; font-size: 18px;padding:40px 30px; text-align: center;">
    Drag file here to send to active connections.
  </div>
  
  
  <div class="warning browser">
    <div class="important">Your browser version: <span id="browsers"></span><br>
  Currently <strong>Firefox 22+ and Google Chrome 26.0.1403.0 or above</strong> is required.</strong></div>For more up to date compatibility
information see <a href="http://peerjs.com/status">PeerJS WebRTC
  Status</a><br>Note that this demo may also fail if you are behind
stringent firewalls or both you and the remote peer and behind symmetric
NATs.

<div class="log" style="color:#FF7500;text-shadow:none;padding:15px;background:#eee"><strong>Connection status</strong>:<br></div>
</div> -->